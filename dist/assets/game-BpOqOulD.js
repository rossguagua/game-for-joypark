import{a as E}from"./supabase-BFUGbfn1.js";let o={},c={},d={},a="mildmode";const u=document.getElementById("topic-card"),n=document.getElementById("topic-text"),v=document.getElementById("refresh-button"),L=document.getElementById("progressIndicator"),r=Array.from(document.querySelectorAll(".category-selector")),b=["surprise","intense","ontheedge","mildmode"],f={surprise:"盲盒 Surprise Me",intense:"加麻加辣 Intense",ontheedge:"微辣 On the Edge",mildmode:"清汤 Mild Mode"},B={surprise:{mainCardColor:"bg-[#FFC9DC]",mainCardTextColor:"text-black"},intense:{mainCardColor:"bg-[#B8B4FF]",mainCardTextColor:"text-black"},ontheedge:{mainCardColor:"bg-[#A0E7E5]",mainCardTextColor:"text-black"},mildmode:{mainCardColor:"bg-[#C8FD0B]",mainCardTextColor:"text-black"}},T={surprise:{left:"calc(50% - 132px)"},intense:{left:"calc(50% - 140px)"},ontheedge:{left:"calc(50% - 148px)"},mildmode:{left:"calc(50% - 158px)"}};r.forEach(t=>{const e=t.dataset.categoryId;t.style.left=T[e].left});async function I(){try{console.log("Loading topics data from database...");for(const t of Object.keys(f)){console.log(`Loading cards for category: ${t}`);const e=await E("drinking-topics",t);console.log(`Loaded ${e.length} cards for ${t}:`,e),o[t]={id:t,...B[t],questions:e.map(i=>i.content)}}console.log("All topics data loaded:",o),k(),document.getElementById("loadingState").style.display="none",document.getElementById("gameContainer").style.display="flex",C(a)}catch(t){console.error("Error loading topics data:",t),document.getElementById("loadingState").style.display="none",document.getElementById("errorState").style.display="block"}}function k(){for(const t in o)o[t]&&o[t].questions&&(c[t]=[...o[t].questions],d[t]=[])}function w(t){o[t]&&o[t].questions&&(c[t]=[...o[t].questions],d[t]=[])}function M(t){if(!c[t]||c[t].length===0)return null;const e=Math.floor(Math.random()*c[t].length),i=c[t][e];return c[t].splice(e,1),d[t].push(i),i}function p(){if(!o[a])return;const t=o[a].questions.length,e=d[a]?d[a].length:0;L.textContent=`${e}/${t}`}function g(){if(!o[a]){n.textContent="话题数据未加载或类型不存在。";return}const t=M(a);if(t===null){F();return}n.classList.remove("topic-fade-in"),n.classList.add("topic-fade-out"),setTimeout(()=>{n.textContent=t,n.classList.remove("topic-fade-out"),n.classList.add("topic-fade-in"),p()},300)}function F(){const t=document.getElementById("completionModal"),e=document.getElementById("completedCount"),i=document.getElementById("currentCategoryName");e.textContent=o[a].questions.length,i.textContent=f[a],t.classList.add("active"),document.body.style.overflow="hidden"}window.closeCompletionModal=function(){document.getElementById("completionModal").classList.remove("active"),document.body.style.overflow=""};window.restartCategory=function(){w(a),p(),closeCompletionModal(),n.classList.remove("topic-fade-in"),n.classList.add("topic-fade-out"),setTimeout(()=>{n.textContent="点击卡片开始新一轮",n.classList.remove("topic-fade-out"),n.classList.add("topic-fade-in")},300)};function S(){if(!o[a]){console.warn("Current category data is not available.");return}const t=o[a];for(const e in o)o.hasOwnProperty(e)&&u.classList.remove(o[e].mainCardColor,o[e].mainCardTextColor);u.classList.add(t.mainCardColor,t.mainCardTextColor)}function C(t){a=t,S(),p(),n.classList.remove("topic-fade-in"),n.classList.add("topic-fade-out"),setTimeout(()=>{n.textContent="点击卡片开始",n.classList.remove("topic-fade-out"),n.classList.add("topic-fade-in")},300);const e=r.find(s=>s.dataset.categoryId===t),i=b.filter(s=>s!==t).map(s=>r.find(m=>m.dataset.categoryId===s));e&&(e.style.transform="translateY(0px) scale(1)",e.style.zIndex=50,e.style.opacity=1),i.forEach((s,m)=>{if(s){const l=m+1,y=-20,x=.05,h=.15;s.style.transform=`translateY(${l*y}px) scale(${1-l*x})`,s.style.zIndex=40-l*10,s.style.opacity=Math.max(.3,1-l*h)}})}window.goBack=function(){window.location.href="index.html"};u.addEventListener("click",t=>{t.target.closest(".category-selector")||g()});v.addEventListener("click",t=>{t.stopPropagation(),g()});r.forEach(t=>{t.addEventListener("click",e=>{e.stopPropagation(),C(t.dataset.categoryId)})});document.getElementById("completionModal").addEventListener("click",function(t){t.target===this&&closeCompletionModal()});document.addEventListener("keydown",function(t){t.key==="Escape"&&closeCompletionModal()});I();
