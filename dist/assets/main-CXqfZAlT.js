import{g as l}from"./supabase-DdduKtNV.js";let m=[],d=null;const g={"battle-royale":"images/eat-chicken-battle-royale.png/image.png","kiss-marks":"images/second-kiss-mark.png/image.png","party-psychology":"images/party-psychology.png/image.png",wisdom:"images/jiubao-quick-wit.png/image.png","man-di-piao-ling":"images/man-di-piao-ling.png/image.png","moon-night":"images/jiubao-yuanyue-ye/image.png","love-battle":"images/chun-ai-da-zuo-zhan.png/image.png",poker:"images/de-zhou-pu-ke-pai.png/image.png"};async function r(){try{console.log("Loading games from database...");const e=performance.now(),t=await l(),s=performance.now()-e;console.log(`Games loaded in ${s.toFixed(2)}ms:`,t),m=t,u()}catch(e){console.error("Error loading games:",e),document.getElementById("loadingState").innerHTML=`
                    <div class="text-center py-8">
                        <p class="text-red-400 mb-4">加载游戏失败</p>
                        <button onclick="location.reload()" class="bg-red-500 text-white px-4 py-2 rounded">重试</button>
                    </div>
                `}}function u(){const e=document.getElementById("loadingState"),t=document.getElementById("mainGameSection"),s=document.getElementById("gameGrid");e.style.display="none";const o=m.find(a=>a.category_tag==="drinking-topics");o&&(t.innerHTML=`
                    <div class="game-card" onclick="showGamePreview('${o.category_tag}')">
                        <div class="main-game-card main-game-fallback">
                            <div class="main-game-title">${o.name}</div>
                            <div class="main-game-subtitle">${o.description}</div>
                        </div>
                    </div>
                `,t.style.display="block");const c=m.filter(a=>a.category_tag!=="drinking-topics");s.innerHTML=c.map(a=>{const n=g[a.category_tag];return`
                    <div class="game-card ${a.category_tag!=="drinking-topics"?"coming-soon":""}" onclick="showGamePreview('${a.category_tag}')">
                        <div class="game-card-content" style="${n?`background-image: url('${n}')`:"background: linear-gradient(135deg, #666 0%, #333 100%)"}">
                            <!-- Image background is set via style -->
                        </div>
                    </div>
                `}).join(""),s.style.display="grid"}window.showGamePreview=function(e){console.log("Showing preview for game:",e),d=e;const t=m.find(n=>n.category_tag===e);if(!t){console.error("Game not found:",e);return}document.getElementById("modalTitle").textContent=t.name,document.getElementById("modalDescription").textContent=t.description||"",document.getElementById("modalPlayers").textContent=t.players||"未知",document.getElementById("modalDuration").textContent=t.duration||"未知";const s=document.getElementById("modalFeatures");s.innerHTML="",t.features&&Array.isArray(t.features)&&t.features.forEach(n=>{const i=document.createElement("span");i.className="feature-tag",i.textContent=n,s.appendChild(i)});const o=document.getElementById("startGameBtn");if(e==="drinking-topics"){o.textContent="开始游戏",o.disabled=!1;const n=document.getElementById("modalTitle").querySelector(".coming-soon-badge");n&&n.remove()}else{o.textContent="即将推出",o.disabled=!0;const n=document.getElementById("modalTitle");if(!n.querySelector(".coming-soon-badge")){const i=document.createElement("span");i.className="coming-soon-badge",i.textContent="即将推出",n.appendChild(i)}}document.getElementById("gameModal").classList.add("active"),document.body.style.overflow="hidden"};window.closeModal=function(){document.getElementById("gameModal").classList.remove("active"),d=null,document.body.style.overflow=""};window.startSelectedGame=function(){if(console.log("Starting game:",d),!d){console.error("No game selected");return}d==="drinking-topics"?(console.log("Navigating to drinking-game.html"),closeModal(),window.location.href="drinking-game.html"):console.log("Game is coming soon, not navigating")};document.getElementById("gameModal").addEventListener("click",function(e){e.target===this&&closeModal()});document.addEventListener("keydown",function(e){e.key==="Escape"&&closeModal()});document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".game-card").forEach(t=>{t.addEventListener("touchstart",function(){this.style.transform="translateY(-2px) scale(0.98)"}),t.addEventListener("touchend",function(){this.style.transform=""})})});r();
